<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Huella Digital Fluida</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.js"></script>
</head>
<body style="margin:0; background:#111;">
<script>
let ip = "0.0.0.0";
let valores;
let index = 0;

function setup() {
  createCanvas(800, 800);
  background(15);
  frameRate(6); // üéµ ritmo vivo pero no apresurado

  // Obtener IP real
  fetch("https://api64.ipify.org?format=json")
    .then(res => res.json())
    .then(data => {
      ip = data.ip;
      valores = ip.split(".").map(n => int(n));
      loop();
    });

  noLoop(); // Esperar IP antes de empezar

  // Bot√≥n descarga
  let btn = createButton('Descargar retrato');
  btn.position(10, 10);
  btn.mousePressed(() => saveCanvas('huella_digital_fluida', 'png'));
}

function draw() {
  if (!valores) return;

  // üå´ fondo con leve memoria
  noStroke();
  fill(10, 10, 20, 30);
  rect(0, 0, width, height);

  let num = valores[index % valores.length] % 10;

  // Cada n√∫mero tiene su propio estilo definido
  switch(num){
    case 0: estilo0(); break;
    case 1: estilo1(); break;
    case 2: estilo2(); break;
    case 3: estilo3(); break;
    case 4: estilo4(); break;
    case 5: estilo5(); break;
    case 6: estilo6(); break;
    case 7: estilo7(); break;
    case 8: estilo8(); break;
    case 9: estilo9(); break;
  }

  // Texto po√©tico
  fill(255, 200);
  textAlign(CENTER);
  textSize(16);
  text("Tu huella digital visual: " + ip, width/2, height - 30);

  index++;
  if (index > valores.length * 60) noLoop(); // Se detiene tras una larga danza
}

// -------------------- ESTILOS (uno por n√∫mero) --------------------

function estilo0() {
  let colores = ['#64B5F680','#90CAF980','#4FC3F780','#29B6F680','#0288D180'];
  for (let i=0;i<random(5,12);i++){
    fill(random(colores));
    ellipse(random(width), random(height), random(20,120));
  }
}

function estilo1() {
  let colores = ['#FF6EC780','#E040FB80','#BA68C880','#8E24AA80','#D500F980'];
  for (let i=0;i<random(3,8);i++){
    fill(random(colores));
    let x=random(width);
    let y=random(height);
    push();
    translate(x,y);
    rotate(random(TWO_PI));
    rect(0,0,random(20,100),random(10,50),10);
    pop();
  }
}

function estilo2() {
  let colores = ['#FFEB3B70','#FFF59D70','#FFD74070','#FBC02D70'];
  for (let i=0;i<random(6,10);i++){
    fill(random(colores));
    let x=random(width);
    let y=random(height);
    beginShape();
    for(let j=0;j<5;j++){
      let angle = TWO_PI/5*j + frameCount*0.01;
      vertex(x+cos(angle)*random(20,50), y+sin(angle)*random(20,50));
    }
    endShape(CLOSE);
  }
}

function estilo3() {
  let colores = ['#FF8A6580','#FF704380','#E64A1980','#D8431580'];
  for(let i=0;i<random(4,9);i++){
    fill(random(colores));
    ellipse(random(width), random(height), random(30,90));
  }
}

function estilo4() {
  let colores = ['#A5D6A780','#81C78480','#66BB6A80','#4CAF5080'];
  for(let i=0;i<random(3,7);i++){
    fill(random(colores));
    let x=random(width);
    let y=random(height);
    push();
    translate(x,y);
    rotate(frameCount*0.02);
    rect(0,0,random(40,80),random(20,60));
    pop();
  }
}

function estilo5() {
  let colores = ['#80DEEA80','#26C6DA80','#00ACC180','#00838F80'];
  for(let i=0;i<random(5,10);i++){
    fill(random(colores));
    let x=random(width);
    let y=random(height);
    triangle(x,y,x+random(30,70),y+random(-30,30),x+random(-40,40),y+random(30,70));
  }
}

function estilo6() {
  let colores = ['#F5F5F580','#BDBDBD80','#9E9E9E80','#75757580'];
  for(let i=0;i<random(6,12);i++){
    fill(random(colores));
    rect(random(width), random(height), random(10,60), random(10,60));
  }
}

function estilo7() {
  let colores = ['#FFB6C180','#F48FB180','#F0629280','#EC407A80'];
  for(let i=0;i<random(3,8);i++){
    fill(random(colores));
    let x=random(width);
    let y=random(height);
    beginShape();
    for(let j=0;j<6;j++){
      let angle=TWO_PI/6*j;
      vertex(x+cos(angle)*random(20,50), y+sin(angle)*random(20,50));
    }
    endShape(CLOSE);
  }
}

function estilo8() {
  let colores = ['#FFF9C480','#FFF59D80','#FFEE5880','#FFF17680'];
  let c1=color(random(colores));
  let c2=color(random(colores));
  for(let j=0;j<random(8,12);j++){
    fill(lerpColor(c1,c2,j/10));
    ellipse(random(width), random(height), random(30,100));
  }
}

function estilo9() {
  let colores = ['#BBDEFB80','#64B5F680','#2196F380','#1976D280'];
  for(let i=0;i<random(3,7);i++){
    fill(random(colores));
    let x=random(width);
    let y=random(height);
    push();
    translate(x,y);
    rotate(random(TWO_PI));
    beginShape();
    for(let j=0;j<random(5,8);j++){
      vertex(cos(j*TWO_PI/6)*random(20,60), sin(j*TWO_PI/6)*random(20,60));
    }
    endShape(CLOSE);
    pop();
  }
}
</script>
</body>
</html>
