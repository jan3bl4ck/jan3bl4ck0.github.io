<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Retrato Interactivo</title>

  <!-- Librerías p5.js y ml5.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/addons/p5.dom.min.js"></script>
  <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>
</head>

<body style="margin:0; overflow:hidden; background:#111;">
<script>
let video;
let faceapi;
let detections = [];
let colores = [];

function setup() {
  createCanvas(800, 600);
  background(10, 10, 20);

  // Activar cámara
  video = createCapture(VIDEO);
  video.size(width, height);
  video.hide();

  // Cargar el modelo de detección facial
  const options = { withLandmarks: true, withExpressions: false, withDescriptors: false };
  faceapi = ml5.faceApi(video, options, modelReady);

  for (let i = 0; i < 20; i++) {
    colores.push(color(random(255), random(255), random(255), random(100, 200)));
  }
}

function modelReady() {
  console.log("✅ Modelo facial cargado y listo");
  faceapi.detect(gotResults);
}

function gotResults(err, result) {
  if (err) {
    console.error(err);
    return;
  }
  detections = result;
  faceapi.detect(gotResults);
}

function draw() {
  background(10, 10, 20, 40);

  if (detections.length > 0) {
    let puntos = detections[0].landmarks.positions;

    for (let p of puntos) {
      fill(random(colores));
      noStroke();
      ellipse(p.x, p.y, random(5, 15));
    }
  } else {
    fill(255, 40);
    textAlign(CENTER);
    textSize(24);
    text("Mira hacia la cámara...", width / 2, height / 2);
  }
}
</script>
</body>
</html>
